<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel With - Find Co-Travellers</title>
    <link rel="stylesheet" th:href="@{/style.css}">
</head>
<body>

<div class="container">
    <h1>Travel With</h1>
    <p class="subtitle">Enter your journey details to find co-travellers.</p>

    <form action="/search" method="post">

        <div class="form-group">
            <label for="name">Your Name</label>
            <input type="text" id="name" name="name" placeholder="Enter your name" required>
        </div>

        <div class="form-group">
            <label for="phone">Phone Number</label>
            <input type="tel" id="phone" name="phoneNo" placeholder="Enter mobile number" maxlength="10" required>
            <div class="help-text">10-digit contact number.</div>
        </div>

        <div class="form-group">
            <label for="sourceStation">Source Station</label>
            <div class="autocomplete-wrapper">
                <input type="text" id="sourceStation" name="sourceStation"
                       placeholder="Type to search (e.g. Bhopal)" required autocomplete="off">
                <div id="source-suggestions" class="suggestions-list"></div>
            </div>
        </div>

        <div class="form-group">
            <label for="destinationStation">Destination Station</label>
            <div class="autocomplete-wrapper">
                <input type="text" id="destinationStation" name="destinationStation"
                       placeholder="Type to search (e.g. Mumbai)" required autocomplete="off">
                <div id="dest-suggestions" class="suggestions-list"></div>
            </div>
        </div>

        <div class="form-group">
            <label for="trainNo">Train Number</label>
            <input type="text" id="trainNo" name="trainNo" placeholder="e.g. 12980" required>
        </div>

        <div class="form-group">
            <label for="journeyDate">Journey Date</label>
            <input type="date" id="journeyDate" name="journeyDate" required>
        </div>

        <div class="form-group">
            <label for="stationTime">Time you will reach station</label>
            <input type="time" id="stationTime" name="stationTime" required>
            <div class="help-text">Used to match people going to station at same time.</div>
        </div>

        <button type="submit" class="btn-submit">Find Co-Travellers</button>
    </form>
</div>

<script th:inline="javascript">
    /* Get the list of stations from Java Model */
    /* Correct way to load data from Java */
    const stations = /*[[${stationList}]]*/ [];

    function setupAutocomplete(inputId, listId) {
        const input = document.getElementById(inputId);
        const list = document.getElementById(listId);

        input.addEventListener('input', function() {
            const query = this.value.toLowerCase();
            list.innerHTML = '';

            if (!query) {
                list.style.display = 'none';
                return;
            }

            const matches = stations.filter(s => s.toLowerCase().includes(query));

            if (matches.length > 0) {
                matches.forEach(station => {
                    const item = document.createElement('div');
                    item.textContent = station;
                    item.addEventListener('click', function() {
                        input.value = station;
                        list.style.display = 'none';
                    });
                    list.appendChild(item);
                });
                list.style.display = 'block';
            } else {
                list.style.display = 'none';
            }
        });

        // Hide list if clicked outside
        document.addEventListener('click', function(e) {
            if (e.target !== input && e.target !== list) {
                list.style.display = 'none';
            }
        });
    }

    // Initialize for both inputs
    setupAutocomplete('sourceStation', 'source-suggestions');
    setupAutocomplete('destinationStation', 'dest-suggestions');
</script>

</body>
</html>